# Migration `20191028170200-add-indices`

This migration has been generated by Julius de Bruijn at 10/28/2019, 5:02:00 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "sql_load_test"."User" (
  "age" integer   ,
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "email" text   ,
  "firstName" text NOT NULL DEFAULT '' ,
  "id" SERIAL,
  "lastName" text NOT NULL DEFAULT '' ,
  "password" text   ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "sql_load_test"."Post" (
  "content" text   ,
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" SERIAL,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "sql_load_test"."Comment" (
  "content" text   ,
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" SERIAL,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "sql_load_test"."Like" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" SERIAL,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "sql_load_test"."_FriendShip" (
  "A" integer   REFERENCES "sql_load_test"."User"("id") ON DELETE CASCADE,
  "B" integer   REFERENCES "sql_load_test"."User"("id") ON DELETE CASCADE
);

ALTER TABLE "sql_load_test"."Post" ADD COLUMN "author" integer   REFERENCES "sql_load_test"."User"("id") ON DELETE SET NULL;

ALTER TABLE "sql_load_test"."Comment" ADD COLUMN "author" integer   REFERENCES "sql_load_test"."User"("id") ON DELETE SET NULL,
ADD COLUMN "post" integer   REFERENCES "sql_load_test"."Post"("id") ON DELETE SET NULL;

ALTER TABLE "sql_load_test"."Like" ADD COLUMN "comment" integer   REFERENCES "sql_load_test"."Comment"("id") ON DELETE SET NULL,
ADD COLUMN "post" integer   REFERENCES "sql_load_test"."Post"("id") ON DELETE SET NULL,
ADD COLUMN "user" integer   REFERENCES "sql_load_test"."User"("id") ON DELETE SET NULL;

CREATE UNIQUE INDEX "User.id" ON "sql_load_test"."User"("id")

CREATE UNIQUE INDEX "Post.id" ON "sql_load_test"."Post"("id")

CREATE  INDEX "Post.author" ON "sql_load_test"."Post"("author")

CREATE UNIQUE INDEX "Comment.id" ON "sql_load_test"."Comment"("id")

CREATE  INDEX "Comment.author" ON "sql_load_test"."Comment"("author")

CREATE  INDEX "Comment.post" ON "sql_load_test"."Comment"("post")

CREATE UNIQUE INDEX "Like.id" ON "sql_load_test"."Like"("id")

CREATE  INDEX "Like.user" ON "sql_load_test"."Like"("user")

CREATE  INDEX "Like.post" ON "sql_load_test"."Like"("post")

CREATE  INDEX "Like.comment" ON "sql_load_test"."Like"("comment")

CREATE UNIQUE INDEX "_FriendShip_AB_unique" ON "sql_load_test"."_FriendShip"("A","B")
```

## Changes

```diff
diff --git datamodel.mdl datamodel.mdl
migration 20191023171743-init..20191028170200-add-indices
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = "postgresql://postgres:prisma@localhost:5432/postgres?schema=sql_load_test"
 }
 generator photon {
   provider = "photonjs"
@@ -30,8 +30,10 @@
   comments  Comment[]
   likes     Like[]
   createdAt DateTime  @default(now())
   updatedAt DateTime  @updatedAt
+
+  @@index([author])
 }
 model Comment {
   id        Int       @id @unique
@@ -40,8 +42,11 @@
   post      Post
   likes     Like[]
   createdAt DateTime  @default(now())
   updatedAt DateTime  @updatedAt
+
+  @@index([author])
+  @@index([post])
 }
 model Like {
   id        Int       @id @unique
@@ -49,5 +54,9 @@
   post      Post
   comment   Comment
   createdAt DateTime  @default(now())
   updatedAt DateTime  @updatedAt
+
+  @@index([user])
+  @@index([post])
+  @@index([comment])
 }
```

## Photon Usage

You can use a specific Photon built for this migration (20191028170200-add-indices)
in your `before` or `after` migration script like this:

```ts
import Photon from '@generated/photon/20191028170200-add-indices'

const photon = new Photon()

async function main() {
  const result = await photon.users()
  console.dir(result, { depth: null })
}

main()

```
